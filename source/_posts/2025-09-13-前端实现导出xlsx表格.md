---
title: 前端实现导出xlsx表格
date: 2025-09-13 10:08:19
tags:
  - export
  - xlsx
categories: 上传/导出
cover: /images/前端实现导出xlsx表格/cover.jpg # 封面图
---

前端根据后端接口返回的数据（数组 / 文件本身 / 链接）做对应的下载处理：

### 👉 根据接口返回的数据数组(表格/列表数据)，前端自己实现 excel 表格下载

**（1）下载依赖**

```bash
npm install xlsx file-saver
```

**（2）编写保存函数 htmlToExcel.js**

```javascript
import FileSaver, { saveAs } from 'file-saver'
import * as XLSX from 'xlsx'
import { ElMessage } from 'element-plus'

export default {
	downloadXlsx(dataList, fileName, wscols) {
		try {
			const stringToBuff = (str) => {
				let buf = new ArrayBuffer(str.length)
				let view = new Uint8Array(buf)
				for (let i = 0; i !== str.length; ++i) {
					view[i] = str.charCodeAt(i) & 0xff
				}
				return buf
			}
			// 创建工作簿
			let workbook = XLSX.utils.book_new()
			// 将数据转换为工作表
			let worksheet = XLSX.utils.aoa_to_sheet(dataList)
			// 设置导出表格每一列的宽
			if (wscols) worksheet['!cols'] = wscols
			// 将工作表添加到工作簿
			XLSX.utils.book_append_sheet(workbook, worksheet, 'sheet1')

			// 创建二进制对象写入转换好的字节流
			let xlsxBlob = new Blob(
				[
					stringToBuff(
						XLSX.write(workbook, {
							bookType: 'xlsx',
							bookSST: false,
							type: 'binary',
						})
					),
				],
				{ type: '' }
			)
			// 下载导出的文件
			FileSaver.saveAs(xlsxBlob, fileName + '.xlsx')
			ElMessage({ type: 'success', message: '导出成功' })
		} catch (e) {
			console.error(e)
			ElMessage.error('导出失败')
		}
	},

	/** 加上 xlsxParam 可以解决导出的表格数据错误的问题,比如以下各种情况等:
	 * 身份证号： 5.23E+17
	 * 日期格式被补全到时分秒
	 * 3% ->  0.03
	 * '1-7' -> 2001/1/7
	 */
	getExcel(dom, fileName) {
		let xlsxParam = { raw: true }
		const domDu = document.querySelector(dom)
		// let worksheet = XLSX.utils.table_to_book(domDu)
		let worksheet = XLSX.utils.table_to_book(domDu, xlsxParam)
		let worksheetout = XLSX.write(worksheet, {
			bookType: 'xlsx',
			bookSST: true,
			type: 'array',
		})
		try {
			FileSaver.saveAs(
				new Blob([worksheetout], { type: 'application/octet-stream' }),
				fileName
			)
			ElMessage({ type: 'success', message: '导出成功' })
		} catch (e) {
			console.error(e)
			ElMessage.error('导出失败')
		}
		return worksheetout
	},
}
```

**（3）直接使用**

```md
<el-table ref="reportRef" v-loading="loading" :data="dataList" id="exportTable">...</el-table>

<script setup>
import download from '@/utils/htmlToExcel.js'
const loading = ref(false)
const dataList = ref([])
const getDataList = () => {}

// 使用方法1
const handleExport = () => {
    let list = [
        [
            "姓名",
            "年龄",
            "性别",
            "学历",
            "创建时间",
        ],
    ];
    dataList.value.forEach((item, index) => {
        list.push([
            item.name,
            item.age,
            item.sex,
            item.education,
            item.createTime,
        ]);
    });
    download.downloadXlsx(list, `2023-12-01.xlsx`);
}

// 使用方法2， 适用于复杂的表格 (单元格合并等情况)
const handleExport = () => {
    download.getExcel('#exportTable', `2023-12-01.xlsx`)
}
</script>
```

### 👉 接口直接返回文件，实现 excel 表格下载

- 接口返回

```javascript
// http.js
import request from '@/utils/request'
export function exportVarTestReport(data) {
	return request({
		url: '/app-api/website/calc/download',
		method: 'get',
		params: data,
		responseType: 'blob',
		headers: {
			'Content-Type': 'application/x-www-form-urlencoded',
		},
	})
}
```
<img src="/images/前端实现导出xlsx表格/exportFile1.png" alt="image" class="max600"/>
<img src="/images/前端实现导出xlsx表格/exportFile2.png" alt="image" class="max600"/>

- 处理数据(下载)

```javascript
// 下载报告操作
function downloadReport(row) {
	try {
		exportReport({
			id: row.id,
		})
			.then((res) => {
				// 处理整个文件res.data
				// ******** 开始 ********
				const link = document.createElement('a')
				const blogObj = new Blob([res.data], {
					type: 'application/vnd.ms-excel',
				})
				// 创建一个新的url对象
				const objectUrl = window.URL.createObjectURL(blogObj)
				link.href = objectUrl
				// 导出文件名
				link.download = `result.xlsx`
				// 自定义下载文件名
				link.click()
				// 为了更好地性能和内存使用状况，应该在适当的时候释放url
				window.URL.revokeObjectURL(objectUrl)
				// ******** 结束 ********
			})
			.catch(() => {
				console.log('下载失败')
			})
			.finally(() => {})
	} catch (error) {}
}
```

### 👉 接口返回一个文件链接，实现点击按钮下载

```javascript
const href = 'http: xxxxx'
clickDownFile('name', href)

// 点击按钮下载
function clickDownFile(filename, href) {
	const a = document.createElement('a')
	a.href = href // a链接的下载地址
	a.setAttribute('download', filename)
	document.body.appendChild(a)
	a.click()
	document.body.removeChild(a)
	window.URL.revokeObjectURL(href)
}
```

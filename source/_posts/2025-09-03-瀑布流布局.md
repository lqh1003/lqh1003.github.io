---
title: 瀑布流布局
date: 2025-09-03 15:19:04
tags:
  - 瀑布流布局
  - css
categories: Javascript
cover: /images/瀑布流布局/cover.jpg # 封面图
---

瀑布流布局（Waterfall Layout）是一种流行的网页布局方式，核心特点是不规则的多列网格结构 —— 每列中的内容块高度不同，内容块会像瀑布流水一样，自动填充到当前高度最低的列中，最终形成错落有致、视觉丰富的布局效果。它广泛应用于图片展示、商品列表、内容卡片等场景（如 Pinterest、Unsplash、小红书的首页 / 搜索页）。

### 🔥 CSS Grid 实现（简单高效）

- CSS Grid 的 grid-template-rows: masonry（砖石布局）特性，这是 CSS 原生支持的瀑布流方案，无需 JS 计算。
  - 优点: 纯 CSS 实现，代码简洁，性能优异，自动适应容器宽度
  - 缺点: 浏览器兼容性有限（Chrome 87+、Firefox 77+ 支持，Safari 暂不支持）
  - 适用场景: 对兼容性要求不高的现代网站，快速实现瀑布流

```html
<template>
	<div class="waterfall">
		<div
			class="item"
			v-for="it in 30"
			:key="it"
			:style="{ '--w': '250px', '--h': Math.floor(Math.random() * 5) * 50 + 'px' }"
		>
			{{ it }}        
		</div>
	</div>
</template>

<style lang="less" scoped>
	/**
	  * grid-template-rows: masonry
	  * CSS Grid 布局中一个特殊的实验性值，用于实现砖石布局（瀑布流效果）。(还有其他实验性值，如 masonry-rows)
	  * 【效果】元素会按列排列，每列的高度根据内容自动调整，新元素优先填充到当前最短的列，形成典型的瀑布流视觉效果。
	  * 【兼容性与限制】目前在 Firefox 和 Chrome 中支持，但需要开启实验性功能。
	  * 【注意】由于是实验性特性，生产环境使用需谨慎，建议作为渐进增强方案。
	 */
	.waterfall {
	    display: grid;
	    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* 每列最小 250px，最大自适应（1fr），自动填充列数 */
	    grid-template-rows: masonry; /* 关键：启用砖石布局，【自动填充最短列】 */
	    gap: 10px; /* 间距 */
	}
	.item {
	    break-inside: avoid; /* 防止内容被分割 */
	    // width: var(--w);
	    height: calc(var(--h) + 200px);
	    background: blue;
	    border-radius: 10px;
	    border: 1px solid #ccc;
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    font-size: 30px;
	    color: #fff;
	}
</style>
```

- 效果：(我开启了实验性功能支持，masonry 砖石布局好像也没有生效???)
  ![](/images/瀑布流布局/waterfall1.png)
- 开启谷歌开启实验性功能：打开浏览，输入 chrome://flags/回车 → 输入实验性功能的关键词搜索 → 启用 Enable
  ![](/images/瀑布流布局/chrome.png)

### 🔥 CSS 多列布局，利用 CSS 的 columns 多列属性，将内容按列分割，自动填充高度

- 优点：纯 CSS 实现，兼容性较好（IE10+ 支持），代码简单
- 缺点：内容按 “列” 顺序排列（而非行），滚动加载时可能需要重新排序；列宽固定，动态调整列数需额外处理
- 适用场景：静态内容展示，对排序顺序要求不高的场景（如：图片墙）

```html
<template>
	<div class="waterfall">
		<div
			class="item"
			v-for="it in 13"
			:key="it"
			:style="{ '--w': '250px', '--h': Math.floor(Math.random() * 5) * 50 + 'px' }"
		>
			{{ it }}
		</div>
	</div>
</template>

<style lang="less" scoped>
	.waterfall {
	    width: 100%;
	    height: unset;
	    columns: 5;  /* 列数 */
	    column-gap: 10px;  /* 列间距 */
	    padding: 30px;
	}
	.item {
	    break-inside: avoid; /* 防止内容被分割 */
	    margin-bottom: 10px;  /* 项间距 */
	    // width: var(--w);  /* 未设置宽，则元素宽度按照5列平分 */
	    height: calc(var(--h) + 200px);
	    background: blue;
	    border-radius: 10px;
	    border: 1px solid #ccc;
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    font-size: 30px;
	    color: #fff;
	}
</style>
```

- 效果：
  ![](/images/瀑布流布局/waterfall2.png)

### 🔥 JavaScript 动态计算（最灵活，兼容性好）

- 优点: 完全可控，支持动态加载、响应式调整列数，兼容性极佳（所有浏览器）
- 缺点: 需要 JavaScript 参与，初始加载和滚动加载时需计算，复杂度略高
- 适用场景: 动态内容（如无限滚动）、对排序和兼容性要求高的场景（如电商商品列表）

```html
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>瀑布流布局</title>
		<style>
			.waterfall {
			    display: flex;
			    gap: 16px;  /* 列间距 */
			    padding: 20px;
			    /* align-items: flex-start让子元素高度由自身内容决定，不随子元素中的最高元素拉伸 */
			    align-items: flex-start;
			}
			.column {
			    flex: 1;
			    display: flex;
			    flex-direction: column;
			    gap: 16px;  /* 元素间距 */
			}
			.item {
			    width: 100%;
			    background: blue;
			    border-radius: 10px;
			    border: 1px solid #ccc;
			    display: flex;
			    align-items: center;
			    justify-content: center;
			    font-size: 30px;
			    color: #fff;
			}
		</style>
	</head>
	<body>
		<div class="waterfall" id="waterfall"></div>
	</body>
	   
	<script>
		// 初始化列
		const columnCount = 5 // 列数
		const waterfall = document.getElementById('waterfall')
		for (let i = 0; i < columnCount; i++) {
			const column = document.createElement('div')
			column.className = 'column'
			waterfall.appendChild(column)
		}
		const columns = document.querySelectorAll('.column')

		// 添加元素到最短列
		function addItem(content, height) {
			// 找到高度最小的列
			let shortestColumn = columns[0]
			columns.forEach((col) => {
				window.console.log(col.offsetHeight, shortestColumn.offsetHeight)
				if (col.offsetHeight < shortestColumn.offsetHeight) {
					shortestColumn = col
				}
			})
			// 创建元素并添加到最短列
			const item = document.createElement('div')
			item.className = 'item'
			item.style.height = `${height}px` // 模拟不同高度
			item.innerHTML = content
			shortestColumn.appendChild(item)
		}

		// 模拟添加内容
		for (let i = 0; i < 20; i++) {
			const randomHeight = Math.floor(Math.random() * 300) + 120 // 120-420px 随机高度
			addItem(`box ${i + 1}`, randomHeight)
		}
	</script>
</html>
```

- 效果：
  ![](/images/瀑布流布局/waterfall3.png)

### 🔥 第三方库实现（快速开发）

使用成熟的瀑布流库，减少重复开发，常见库包括：

- Masonry（最流行）https://masonry.desandro.com

  - 特点：轻量、灵活，支持动画和响应式，需配合 jQuery 或独立使用

- Isotope：https://isotope.metafizzy.co

  - 特点：支持瀑布流、排序、过滤等功能，功能更全面，但体积稍大。

下载依赖：`npm install masonry-layout -D` 或 `npm install isotope-layout -D`

代码如下：(两个插件库使用方法相似)

```html
<template>
	<div class="grid">
		<div
			class="grid-item"
			v-for="it in 15"
			:key="it"
			:style="{ '--w': '300px', '--h': Math.random() * 200 + 'px' }"
		>
			{{ it }}        
		</div>
	</div>
</template>
<script setup>
	import { onMounted } from 'vue'
	import * as Masonry from 'masonry-layout'
	// import * as Isotope from 'isotope-layout';
	onMounted(() => {
		const grid = document.querySelector('.grid')
		if (grid) {
			new Masonry(grid, {
				itemSelector: '.grid-item',
				columnWidth: '.grid-item',
				percentPosition: true,
				gutter: 10, // 列间距
			})
		}
	})
</script>
<style lang="less" scoped>
	.grid {
	    background-color: #999;
	    .grid-item {
	        width: var(--w);
	        height: calc(var(--h) + 120px);  /* 120-320px */
	        background-color: blue;
	        border-radius: 10px;
	        border: 1px solid #ccc;
	        margin-bottom: 10px;  /* 元素间距 */
	        display: flex;
	        align-items: center;
	        justify-content: center;
	        font-size: 30px;
	        color: #fff;
	    }
	}
</style>
```

- 效果：
  ![](/images/瀑布流布局/waterfall4.png)

【总结】

- 快速实现且兼容性要求不高 → 选 CSS Grid 砖石布局。
- 兼容性优先且内容静态 → 选 CSS 多列布局。
- 动态内容或复杂交互 → 选 JavaScript 计算 或 第三方库。
